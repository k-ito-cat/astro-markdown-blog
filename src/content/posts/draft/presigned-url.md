---
title: "S3署名付きURLへの画像アップロードの流れ"
publishedAt: "2025-04-06"

githubUrl: ""
categories: []
---

s3 しょめい付きurl発行とそこに画像登録の流れ

feからs3へ直接しょめい付きurl取得してputするにはシークレットキーが必要だが、fe側でシークレットキーを持つとpublicでブラウザのソースコードに露出してしまう。から、beでシークレットキーをもってもらいつつ、be側でしょめい付きurlをつくってもらう。
で、feではまずしょめい付きurlの生成をリクエストし、そのレスポンスとしてしょめい付きurlをもらう。
そのしょめい付きurlにたいしてputをして画像を保存する。
だけど、s3のバケットに画像は入るけどdbに画像が入らない。つまり、データと紐づかない（例えばユーザープロフィールの編集とかだったら、s3にユーザープロフィールの画像は紐づくけど、dbのプロフィール画像はからっぽのまま）ので、紐づけをするためにs3にputするタイミングで一意なハッシュをbeに送り、それをdbに格納してもらう。その時格納されるのはs3のきげん付きurlのパス？

- ポイントは,FEでシークレットキーをもてないからbeにもってもらってそこで署名付きurlの発行をしてもらうということ
- s3とdbの整合性を保つ必要性があるということ
